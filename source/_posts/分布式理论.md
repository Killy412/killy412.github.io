---
title: 分布式理论
date: 2020-11-08 21:18:07
tags: "分布式"
---

#### CAP 理论

> CAP 原则又称 CAP 定理，指的是在一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性）这三个基本需求，最多只能同时满足其中的 2 个。

|               选项                |                                                   描述                                                   |
| :-------------------------------: | :------------------------------------------------------------------------------------------------------: |
|        Consistency(一致性)        |                           指数据在多个副本之间能够保持一致的特性(严格的一致性)                           |
|       Availability(可用性)        |    指系统提供的服务必须一直处于可用的状态,每次请求都能够获取到非错的响应(不保证获取的数据为最新数据)     |
| Partition tolerance（分区容错性） | 分布式系统遇到任何网络分区故障的时候,仍然能够对外提供满足一致性和可用性的服务,除非整个网络环境都发生故障 |

##### 分区

> 在分布式系统中，不同的节点分布在不同的子网络中，由于一些特殊的原因，这些子节点之间出现了网络不通的状态，但他们的内部子网络是正常的。从而导致了整个系统的环境被切分成了若干个孤立的区域，这就是分区。

- CA without P
  如果不要求 P(不允许分区)，则 C(强一致性)和 A(可用性)是可以保证的。但其实分区不是你想不想的问题，而是始终会存在，因此 CA 的系统更多的是允许分区后各子系统依然保持 CA。

- CP without A
  如果不要求 A(可用),相当于每个请求都需要在 Server 之间强一致，而 P(分区)会导致同步时间无限延长，如此 CP 也是可以保证的。很多传统的数据库分布式事务都属于这种模式。

- AP wihtout C
  要高可用并允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。现在众多的 NoSQL 都属于此类。

#### BASE 理论

BASE 理论是 Basically Available(基本可用)，Soft State(软状态)和 Eventually Consistent(最终一致性)三个短语的缩写。

其核心思想是：

> 既是无法做到强一致性(Strong consistency)，但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性(Eventual consistency)

- 基本可用(Basically Available)
- 软状态(Soft State)
  相对于原子性而言,要求多个节点的数据副本都是一致的,这是一种硬状态.
  软状态是指系统中的数据存在中间状态,并认为该状态不影响系统的整体可用性,既允许系统在多个不同节点的数据副本存在数据延时.
- 最终一致性(Eventually Consistent)
  不能是一直软状态,必须有个时间期限,到达之后,所有副本数据要保持一致性,从而达到最终数据一致性.这个时间期限取决于网络延时,系统负载,数据复制方案设计等.
  最终一致性分五种:
  - 因果一致性
  - 读已之所写
  - 会话一致性
  - 单调读一致性
  - 单调写一致性
